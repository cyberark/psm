---
# tasks file for psm_validateparameters
- name: check EULA is accepted
  fail:
    msg: "You must accept EULA to start the playbook"
  when: accept_eula|lower != "yes"
  
- name: check SQL EULA is accepted
  fail:
    msg: "You must accept SQL EULA to start the playbook"
  when: accept_sql_eula|lower != "yes"

- name: check if psm_disable_nla is defined
  fail: 
    msg: "psm_disable_nla is undefined, please provide the parameter value"
  when: psm_disable_nla is not defined

- name: check if psm_zip_file_path undefined
  fail: 
    msg: "psm_zip_file_path is undefined, failing..."
  when: psm_zip_file_path is not defined

### TODO: Move to pas orchestrator####
# - name: check if psm_zip_file_path exists
#   stat:
#     path: "{{ psm_zip_file_path }}"
#   register: st
#   delegate_to: localhost
#   become: no
  
# - fail: 
#     msg: "{{ psm_zip_file_path }} not exists, failing..."
#   when: not st.stat.exists

- name: check psm service status
  win_service: 
    name: "{{ psm_service_name }}"
  register: psm_service_info
  
- set_fact:
    psm_exists: true
  when: psm_service_info.exists

- name: check if psm is registered
  set_fact:
    psm_registered: true
  when: 
    - psm_service_info.exists 
    - psm_service_info.state == "running" 
    