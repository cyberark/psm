---
# tasks file for psm registration

- name: Execute psm registration
  win_command: 'RegisterComponent.exe PSM /accepteula Yes /vaultip {{ vault_ip }} /vaultport {{ vault_port }} /vaultuser {{ vault_username }} /vaultpassword {{ vault_password }} /psminstalldir "{{ psm_installation_path }}"'
  args:
    chdir: "{{ psm_registrationtool_folder }}"

- name: start psm service & set to auto
  win_service:
    name: "{{ psm_service_name }}"
    start_mode: auto

- name: check if psm service is running
  win_service: 
    name: "{{ psm_service_name }}"
  register: psm_service_info
  
- set_fact:
    psm_registered: true
  when: psm_service_info.state == "running" 
  