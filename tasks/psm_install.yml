---
# tasks file for psm installation

- name: execute psm installation
  win_shell: |
    Set-Location "{{ psm_installationautomation_folder }}"
    $Action = .\Execute-Stage.ps1 "{{ psm_installationautomation_folder }}\Installation\InstallationConfig.xml" -displayJson -delayedrestart
    $Action | Out-File -FilePath "{{ psm_installationautomation_folder }}\psm_installation_result.txt"
    $Result = Get-Content "{{ psm_installationautomation_folder }}\psm_installation_result.txt" | ConvertFrom-Json
    if ($Result.isSucceeded -eq 2) {
        exit 1
    } else {
        exit 0
    }

- name: check if psm service status
  win_service: 
    name: "{{ psm_service_name }}"
  register: psm_service_info
  
- set_fact:
    psm_exists: "{{ psm_service_name.exists }}"